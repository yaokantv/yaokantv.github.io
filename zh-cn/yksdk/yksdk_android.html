<!DOCTYPE html>
<html lang="zh-cn">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>Yaokantv</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://doc.yaokantv.com/zh-cn/yksdk/yksdk_android.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="zh-cn" href="https://doc.yaokantv.com/zh-cn/yksdk/yksdk_android.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <meta name="generator" content="Hexo 3.8.0">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="Yaokantv">
  <!-- Open Graph -->
  <meta name="description" content="一、集成SDK1.将yksdk.arr拷贝到libs目录下后，在工程里的app→src→build.gradle 根目录添加以下代码 repositories{       flatDir {             dirs &amp;apos;libs&amp;apos;           }   }  工程里的app→src→build.gradle 的根目录的 dependencies 标签里面添加 i">
<meta property="og:type" content="website">
<meta property="og:title" content="Yaokantv">
<meta property="og:url" content="https://doc.yaokantv.com/zh-cn/yksdk/yksdk_android.html">
<meta property="og:site_name" content="Yaokantv">
<meta property="og:description" content="一、集成SDK1.将yksdk.arr拷贝到libs目录下后，在工程里的app→src→build.gradle 根目录添加以下代码 repositories{       flatDir {             dirs &amp;apos;libs&amp;apos;           }   }  工程里的app→src→build.gradle 的根目录的 dependencies 标签里面添加 i">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://github.com/yaokantv/YKSDK-Android/blob/master/img/cap1.jpg">
<meta property="og:image" content="https://github.com/yaokantv/YKCenterSDKExample_for_AS/blob/master/app/img/one_key.png">
<meta property="og:updated_time" content="2018-12-04T10:14:50.724Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yaokantv">
<meta name="twitter:description" content="一、集成SDK1.将yksdk.arr拷贝到libs目录下后，在工程里的app→src→build.gradle 根目录添加以下代码 repositories{       flatDir {             dirs &amp;apos;libs&amp;apos;           }   }  工程里的app→src→build.gradle 的根目录的 dependencies 标签里面添加 i">
<meta name="twitter:image" content="https://github.com/yaokantv/YKSDK-Android/blob/master/img/cap1.jpg">
<meta name="twitter:site" content="hexojs">
<meta property="fb:admins" content="100000247608790">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48498357-3', 'auto');
  ga('send', 'pageview');
</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6482217598104186",
          enable_page_level_ads: true
     });
  </script>
</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/zh-cn/" id="logo">Hexo</a>
    </h1>
    <nav id="main-nav">
      <a href="/zh-cn/ykzxsdk/" class="main-nav-link">遥控中心SDK</a><a href="/zh-cn/yksdk/" class="main-nav-link">遥看SDK</a>
    </nav>
    <div id="lang-select-wrap">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>简体中文</span></label>
      <select id="lang-select" data-canonical="">
        
          <option value="zh-cn" selected>简体中文</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name"></h1>
                <a href="https://github.com/yaokantv/yk_wiki/edit/master/source/zh-cn/yksdk/yksdk_android.md" class="article-edit-link" title="改进本文"><i class="fa fa-pencil"></i></a>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h1 id="一、集成SDK" class="article-heading"><a href="#一、集成SDK" class="headerlink" title="一、集成SDK"></a>一、集成SDK<a class="article-anchor" href="#一、集成SDK" aria-hidden="true"></a></h1><p>1.将yksdk.arr拷贝到libs目录下后，在工程里的app→src→build.gradle 根目录添加以下代码</p>
<pre><code>repositories{  
    flatDir {        
    dirs &apos;libs&apos;       
   }  
}
</code></pre><ol start="2">
<li><p>工程里的app→src→build.gradle 的根目录的 dependencies 标签里面添加</p>
<pre><code>implementation(name:’yksdk&apos;,   ext:&apos;aar&apos;)
implementation &apos;com.google.code.gson:gson:2.8.2&apos;
</code></pre></li>
</ol>
<p>如图：<br><img src="https://github.com/yaokantv/YKSDK-Android/blob/master/img/cap1.jpg" alt="image"></p>
<p>3.在自己的application里面，实现如下方法：</p>
<pre><code>public class App extends Application {
    @Override
    public void onCreate() {
        super.onCreate();

    }
    @Override
    protected void attachBaseContext(Context base) {
        super.attachBaseContext(base);
        com.jiagu.sdk.yksdkProtected.install(this);
    }
}
</code></pre><p>4.添加网络请求权限</p>
<pre><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
</code></pre><h1 id="二、Api调用" class="article-heading"><a href="#二、Api调用" class="headerlink" title="二、Api调用"></a>二、Api调用<a class="article-anchor" href="#二、Api调用" aria-hidden="true"></a></h1><h2 id="1-1-初始化YKSDK" class="article-heading"><a href="#1-1-初始化YKSDK" class="headerlink" title="1.1 初始化YKSDK"></a>1.1 初始化YKSDK<a class="article-anchor" href="#1-1-初始化YKSDK" aria-hidden="true"></a></h2><pre><code>// 初始化SDK
YkanIRInterfaceImpl ykanInterface = new YkanIRInterfaceImpl(getApplicationContext());
    new Thread(new Runnable() {
        @Override
        public void run() {
            final boolean b = ykanInterface.init(&quot;此处填入App ID&quot;);

            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    if (b) {
                        Toast.makeText(MainActivity.this, &quot;初始化成功！！！&quot;, Toast.LENGTH_SHORT).show();
                        initView();
                    } else {
                        Toast.makeText(MainActivity.this, &quot;初始化失败！！！&quot;, Toast.LENGTH_SHORT).show();
                    }
                }
            });
        }
    }).start();
</code></pre><p><strong>注意：只有在初始化完成之后，App才能完成后续的操作。</strong></p>
<h2 id="1-2-获取遥控云所有的设备类型" class="article-heading"><a href="#1-2-获取遥控云所有的设备类型" class="headerlink" title="1.2 获取遥控云所有的设备类型"></a>1.2 获取遥控云所有的设备类型<a class="article-anchor" href="#1-2-获取遥控云所有的设备类型" aria-hidden="true"></a></h2><pre><code>【示例代码】
/**
* @param mac：设备Mac地址
* @param listener:http请求回调方法
*/
ykanInterface.getDeviceType(currGizWifiDevice.getMacAddress(), new YKanHttpListener() {
    @Override
    public void onSuccess(BaseResult baseResult) {
        DeviceTypeResult deviceResult = (DeviceTypeResult) baseResult;
        ...
    }
    @Override
    public void onFail(YKError ykError) {
        Log.e(TAG, &quot;ykError:&quot; + ykError.toString());
    }
});
</code></pre><h2 id="1-3-获取设备类型下面的所有品牌" class="article-heading"><a href="#1-3-获取设备类型下面的所有品牌" class="headerlink" title="1.3 获取设备类型下面的所有品牌"></a>1.3 获取设备类型下面的所有品牌<a class="article-anchor" href="#1-3-获取设备类型下面的所有品牌" aria-hidden="true"></a></h2><pre><code>【示例代码】
/**
 * @param mac:设备Mac地址
 * @param type：设备型号
 * @param listener:http请求回调方法
 */
ykanInterface.getBrandsByType(currGizWifiDevice.getMacAddress(), currDeviceType.getTid(), new 
    YKanHttpListener() {
    @Override
    public void onSuccess(BaseResult baseResult) {
        BrandResult brandResult = (BrandResult) baseResult;
    }
    @Override
    public void onFail(YKError ykError) {
        Log.e(TAG, &quot;ykError:&quot; + ykError.toString());
    }
});
</code></pre><h2 id="1-4-根据品牌id和设备类型获取匹配的遥控器对象集合" class="article-heading"><a href="#1-4-根据品牌id和设备类型获取匹配的遥控器对象集合" class="headerlink" title="1.4 根据品牌id和设备类型获取匹配的遥控器对象集合"></a>1.4 根据品牌id和设备类型获取匹配的遥控器对象集合<a class="article-anchor" href="#1-4-根据品牌id和设备类型获取匹配的遥控器对象集合" aria-hidden="true"></a></h2><pre><code>【示例代码】
/**
 * @param mac:设备Mac地址
 * @param bid:品牌ID
 * @param type:设备类型ID
 * @param listener:http请求回调方法
 */
 ykanInterface.getRemoteMatched(currGizWifiDevice.getMacAddress(),currBrand.getBid(), currDeviceType.getTid(), new YKanHttpListener() {
    @Override
    public void onSuccess(BaseResult baseResult) {
        controlResult = (MatchRemoteControlResult) baseResult;
    }
    @Override
    public void onFail(YKError ykError) {
        Log.e(TAG, &quot;ykError:&quot; + ykError.toString());
    }
});
</code></pre><h2 id="1-5-根据遥控ID获取遥控器相关详细信息" class="article-heading"><a href="#1-5-根据遥控ID获取遥控器相关详细信息" class="headerlink" title="1.5 根据遥控ID获取遥控器相关详细信息"></a>1.5 根据遥控ID获取遥控器相关详细信息<a class="article-anchor" href="#1-5-根据遥控ID获取遥控器相关详细信息" aria-hidden="true"></a></h2><pre><code>【示例代码】
/**
 * @param mac:设备Mac地址
 * @param rcID:遥控器ID
 * @param listener:http请求回调方法
 */
 ykanInterface.getRemoteDetails(currGizWifiDevice.getMacAddress(), currRemoteControl.getRid(), new YKanHttpListener() {
    @Override
    public void onSuccess(BaseResult baseResult) {
        if (baseResult != null) {
            remoteControl = (RemoteControl) baseResult;
        }
    }
    @Override
    public void onFail(YKError ykError) {
        Log.e(TAG, &quot;ykError:&quot; + ykError.toString());
    }
});
</code></pre><h2 id="1-6-获取遥控器码库" class="article-heading"><a href="#1-6-获取遥控器码库" class="headerlink" title="1.6 获取遥控器码库"></a>1.6 获取遥控器码库<a class="article-anchor" href="#1-6-获取遥控器码库" aria-hidden="true"></a></h2><p>根据遥控器tid判断是否为空调设备 </p>
<pre><code>if (remoteControl != null &amp;&amp; remoteControl.getRcCommand() != null &amp;&amp; remoteControl.gettId() != 7) {//普通设备
    intent = new Intent(MainActivity.this, NormalDeviceActivity.class);
    try {
        intent.putExtra(&quot;remoteControl&quot;, jsonParser.toJson(remoteControl));
        intent.putExtra(&quot;rcCommand&quot;, jsonParser.toJson(remoteControl.getRcCommand()));
    } catch (JSONException e) {
        Log.e(TAG, &quot;JSONException:&quot; + e.getMessage());
    }
    startActivity(intent);
} else if (remoteControl != null &amp;&amp; remoteControl.getRcCommand() != null &amp;&amp; remoteControl.gettId() == 7) {//空调设备
    intent = new Intent(MainActivity.this, AirDeviceActivity.class);
    try {
        intent.putExtra(&quot;remoteControl&quot;, jsonParser.toJson(remoteControl));
    } catch (JSONException e) {
        Log.e(TAG, &quot;JSONException:&quot; + e.getMessage());
    }
    startActivity(intent);
}
</code></pre><p>每个遥控器对象里面都有RcCommand这个属性，取得之后用JsonParser解析就能得到遥控器里所有的码值。</p>
<pre><code>Type type = new TypeToken&lt;HashMap&lt;String, KeyCode&gt;&gt;(){}.getType();
//解析数据
HashMap&lt;String, KeyCode&gt; codeDatas = new JsonParser().parseObjecta(rcCommand, type);
</code></pre><h2 id="1-7-一键匹配" class="article-heading"><a href="#1-7-一键匹配" class="headerlink" title="1.7 一键匹配"></a>1.7 一键匹配<a class="article-anchor" href="#1-7-一键匹配" aria-hidden="true"></a></h2><p>遥控器一键匹配的本质是一个将学习到的红外码上传到云端服务器匹配的过程，该过程分为一下几个步骤：</p>
<p> step1：第一次调用一键匹配接口时，先确认匹配遥控器的类型</p>
<pre><code> if(遥控器是空调或者汽车多媒体(SDK暂未提供)){
    key=&quot;ok&quot;;
}else{
    key=&quot;power&quot;;
}
</code></pre><p> step2:学习成功后，调用一键匹配接口将红外码值上传到云端</p>
<pre><code>ykanInterface.oneKeyMatched(gizWifiDevice.getMacAddress(), studyValue, tid + &quot;&quot;, bid + &quot;&quot;, key, OneKeyMatchActivity.this);
</code></pre><p> step3:解析回调</p>
<pre><code> @Override
public void onSuccess(BaseResult baseResult) {
    if (isFinishing()) {
        return;
    }
    dialogUtils.sendMessage(ProgressDialogUtils.DISMISS);
    if (baseResult instanceof OneKeyMatchKey) {
        key = ((OneKeyMatchKey) baseResult).getNext_cmp_key();
        showDlg();
    } else if (baseResult instanceof RemoteControl) {
        remoteControl = (RemoteControl) baseResult;
        runOnUiThread(new Runnable() {
            @Override
            public void run() {
                new AlertDialog.Builder(OneKeyMatchActivity.this).setMessage(&quot;匹配成功，进入测试&quot;).setPositiveButton(&quot;确定&quot;, new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        toYKWifiDeviceControlActivity();
                    }
                }).create().show();
            }
        });
    } else if (baseResult instanceof MatchRemoteControlResult) {
        final MatchRemoteControlResult result = (MatchRemoteControlResult) baseResult;
        Log.e(&quot;tttt&quot;, result.toString());
        if (result != null &amp;&amp; result.getRs() != null &amp;&amp; result.getRs().size() &gt; 0) {
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    list.clear();
                    list.addAll(result.getRs());
                    controlAdapter.notifyDataSetChanged();
                }
            });
        }
    }
}
 @Override
public void onFail(final YKError ykError) {
    dialogUtils.sendMessage(ProgressDialogUtils.DISMISS);
    runOnUiThread(new Runnable() {
        @Override
        public void run() {
            new AlertDialog.Builder(OneKeyMatchActivity.this).setMessage(ykError.getError()).setPositiveButton(&quot;确定&quot;, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    dialog.dismiss();
                }
            }).create().show();
        }
    });
}
</code></pre><p>回调有四种情况:</p>
<p>当回调成功时</p>
<p>1.如果结果属于OneKeyMatchKey时，则说明要继续匹配下一个键，键值包含在对象里，将全局对象key替换后，重复step2操作。<br>(这里返回的key为英文，<a href="https://github.com/yaokantv/YKCenterSDKExample_for_AS/wiki/%E9%81%A5%E6%8E%A7%E5%99%A8%E5%AF%B9%E5%BA%94%E9%94%AE%E5%90%8D" target="_blank" rel="noopener">需要翻译成中文的请戳这里</a>)</p>
<p>2.如果结果属于RemoteControl时，则说明匹配成功，这时你只需要把匹配成功的遥控器保存下来就可以了</p>
<p>3.如果结果属于MatchRemoteControlResult时，则说明匹配回来的是空调遥控器数组(一般匹配空调都会以数组的形式返回)，数组里面包含遥控器的几个按键，这时你可以用来测试实体家电，测试成功之后再下载完整的遥控器数据。<br>如下图所示<img src="https://github.com/yaokantv/YKCenterSDKExample_for_AS/blob/master/app/img/one_key.png" alt="image"></p>
<p>4.除以上3中情况，其他情况均为匹配失败。</p>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2018-12-04T10:14:50.724Z" itemprop="dateModified">上次更新：2018-12-04</time>
                <a href="index.html" class="article-footer-prev" title="遥看iOS"><i class="fa fa-chevron-left"></i><span>上一篇</span></a>
              </footer>
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">目录</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、集成SDK"><span class="toc-text">一、集成SDK</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、Api调用"><span class="toc-text">二、Api调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-初始化YKSDK"><span class="toc-text">1.1 初始化YKSDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-获取遥控云所有的设备类型"><span class="toc-text">1.2 获取遥控云所有的设备类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-获取设备类型下面的所有品牌"><span class="toc-text">1.3 获取设备类型下面的所有品牌</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-根据品牌id和设备类型获取匹配的遥控器对象集合"><span class="toc-text">1.4 根据品牌id和设备类型获取匹配的遥控器对象集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-根据遥控ID获取遥控器相关详细信息"><span class="toc-text">1.5 根据遥控ID获取遥控器相关详细信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-获取遥控器码库"><span class="toc-text">1.6 获取遥控器码库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-一键匹配"><span class="toc-text">1.7 一键匹配</span></a></li></ol></li></ol>
              <a href="#" id="article-toc-top">回到顶部</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">iOS</strong><a href="index.html" class="sidebar-link">遥看iOS</a><strong class="sidebar-title">安卓</strong><a href="yksdk_android.html" class="sidebar-link current">遥看安卓</a>
  </div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2018 <a href="https://www.yaokantv.com" target="_blank">遥看科技</a><br>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/zh-cn/ykzxsdk/" class="mobile-nav-link">遥控中心SDK</a><a href="/zh-cn/yksdk/" class="mobile-nav-link">遥看SDK</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/hexojs/hexo" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">iOS</strong><a href="index.html" class="mobile-nav-link">遥看iOS</a><strong class="mobile-nav-title">安卓</strong><a href="yksdk_android.html" class="mobile-nav-link current">遥看安卓</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>简体中文</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="zh-cn" selected>简体中文</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- Cookie -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.0/js.cookie.min.js"></script>
<!-- build:js build/js/main.js -->
<script src="/js/lang_select.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<!-- endbuild -->

<!-- Algolia -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
 <script type="text/javascript">
// document.getElementById('search-input-wrap').classList.add('on'); 
// docsearch({
//   apiKey: 'cdea7d4e47d84f6145b77e7f68689f35',
//   indexName: 'hexo_zh-cn',
//   inputSelector: '#search-input'
// });
 </script>


</body>
</html>